<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="ol.css" type="text/css">
	    <style>
	        .map {
	            height: 800px;
	            width: 100%;
	        }
	        .button {
	            height: 40px;
	            width: 100px;
	        }
	    </style>
	    <script src="ol.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="map" class="map"></div>
		<form class="form-inline">
		  <label>Geometry type &nbsp;</label>
		  <select id="type">
		  	<option value="Polygon">Polygon</option>
		    <option value="Point">Point</option>
		    <option value="LineString">LineString</option>
		    <option value="Circle">Circle</option>
		    <option value="None">None</option>
		  </select>
		</form>
		<script>
			var raster = new ol.layer.Tile({
			  source: new ol.source.OSM()
			});
			console.log(ol)
			var source = new ol.source.Vector({wrapX: false});
			
			var vector = new ol.layer.Vector({
			  source: source
			});
			
			var map = new ol.Map({
			  layers: [raster, vector],
			  target: 'map',
			  view: new ol.View({
			    center: ol.proj.fromLonLat([121.4539, 31.27405]),
			    zoom: 10
			  })
			});
			
			var typeSelect = document.getElementById('type');
			
			var draw; // global so we can remove it later
			function addInteraction() {
			  var value = typeSelect.value;
			  if (value !== 'None') {
			    draw = new ol.interaction.Draw({
			      source: source,
			      type: typeSelect.value
			    });
			    map.addInteraction(draw);
			  }
			}
			
			
			/**
			 * Handle change event.
			 */
			typeSelect.onchange = function() {
			  map.removeInteraction(draw);
			  addInteraction();
			  /*source.addFeature(new ol.Feature({
			    geometry: ol.geom.Polygon.fromExtent(source.getFeatures()[0].getGeometry().getExtent())
			  }))*/
			  //var coord = ol.proj.transform([p[1], p[0]], 'EPSG:4326', 'EPSG:3857');
			  
			  console.log(convertCoord(source.getFeatures()[0].getGeometry().getCoordinates()[0]));
			};
			
			var convertCoord = function(coord) {
				let arr = [];
				for(let i=0; i<coord.length; i++){
					arr.push(ol.proj.transform(coord[i], 'EPSG:3857','EPSG:4326'));
				}
				return arr;
			}
			
			addInteraction();

		</script>
	</body>
</html>
